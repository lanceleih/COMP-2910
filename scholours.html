<!DOCTYPE html>
<html>
<head>
<script>

	window.onload = function() {
		const MAX_TILES = 16;
		const MAX_ROWS = 4;
		const MAX_COLS = MAX_TILES / MAX_ROWS;
		const OFFSET_LEFT = 20;
		const OFFSET_RIGHT = 20;
		const OFFSET_TOP = 100;
		const OFFSET_BOTTOM = 100;
		const BOARD_WIDTH = 320 - OFFSET_LEFT - OFFSET_RIGHT;
		const BOARD_HEIGHT = 480 - OFFSET_TOP - OFFSET_BOTTOM;
		const TILE_SHAPE = "square";
		const DEFAULT_COLOR = "#FFFFFF";
		const TILE_WIDTH = BOARD_WIDTH / MAX_ROWS;
		const TILE_HEIGHT = BOARD_HEIGHT / MAX_COLS;

		var tiles;
		var tilesColored = 0;

		// Jungle Love - Daniel Shin
		//var palette = ["#998365", "#56FF6F", "#FF80DC", "#FEF216"];

		// Backstreet's Back - Lancelei Herradura
		//var palette = ["#1E3259", "#BFA58E", "#736B6A", "#260101"];

		// Ice Cream Desserts - Haley Booker
		var palette = ["#A1C4A6", "#FBD78D", "#F5634A", "#953B32"];
		var colorInventory = new Array(4);
		var c = document.getElementById("myCanvas");
		var ctx = c.getContext("2d");
		ctx.strokeStyle = "#000000";
		ctx.lineWidth = 1;
		ctx.shadowColor = "transparent";
		createTileArray(MAX_ROWS, MAX_COLS);
		drawTiles();
		initializeColorInventory();
		createFixedTiles();
		createTimer();
		createPauseBtn();
		c.addEventListener("mousedown", doMouseDown, false);

		function createTileArray(row, col) {
			tiles = new Array(row);
			for (var i = 0; i < row; i++) {
				tiles[i] = new Array(col);
				for (var j = 0; j< col; j++) {
					tiles[i][j] = {
						shape: TILE_SHAPE,
						color: -1,
						width: TILE_WIDTH - 2,
						height: TILE_HEIGHT - 2,
						x: TILE_WIDTH * j + OFFSET_LEFT + 1,
						y: TILE_HEIGHT * i + OFFSET_TOP + 1,
						fixed: false
					};
				}
			}
		}

		function drawTiles() {
			for (var i = 0; i < tiles.length; i++) {
				for (var j = 0; j < tiles[0].length; j++) {
					ctx.beginPath();
					ctx.fillStyle = DEFAULT_COLOR;
					ctx.rect(tiles[i][j].x, tiles[i][j].y, tiles[i][j].width, tiles[i][j].height);
					ctx.stroke();
					ctx.fill();
					ctx.closePath();
				}
			}
		}

		function doMouseDown(event) {
			var canvas_x = event.pageX - c.offsetLeft;
			var canvas_y = event.pageY - c.offsetTop;
			if (canvas_x > OFFSET_LEFT && canvas_x < OFFSET_LEFT + BOARD_WIDTH && canvas_y > OFFSET_TOP && canvas_y < OFFSET_TOP + BOARD_HEIGHT) {
//				alert("X = " + canvas_x + " Y = " + canvas_y);
				var tile = getTile(canvas_x, canvas_y);
				if (tile.fixed === false) {
					fillTile(tile);
				}
			}
			/*else {
				alert(canvas_x + ", " + canvas_y);
			}*/
			if (tilesColored == MAX_TILES) {
				if (validateGame() === true) {
					alert("CONGRATULATION! You beat the game.");
				}
			}
		}

		function getTile(coordX, coordY) {
			for (var i = 0; i < tiles.length; i++) {
				for (var j = 0; j < tiles[0].length; j++) {
					if (tiles[i][j].x < coordX && tiles[i][j].x + tiles[i][j].width > coordX) {
						if (tiles[i][j].y < coordY && tiles[i][j].y + tiles[i][j].height > coordY) {
//							alert(tiles[i][j].x + " < " + coordX + " < " + (tiles[i][j].x + tiles[i][j].width) + "\n"
//								+ tiles[i][j].y + " < " + coordY + " < " + (tiles[i][j].y + tiles[i][j].height) + "\n"
//								+ "It's tiles[" + j + "][" + i + "]");
							return tiles[i][j];
						}
					}
				}
			}
		}

		function fillTile(tile) {
			var newColor = getNextColor(tile.color);
			while (colorInventory[newColor] === 0) {
				newColor = getNextColor(newColor);
			}
			if (newColor === -1) {
				ctx.fillStyle = DEFAULT_COLOR;
			} else {
				ctx.fillStyle = palette[newColor];
			}
			ctx.clearRect(tile.x, tile.y, tile.width, tile.height);
			ctx.beginPath();
			ctx.rect(tile.x, tile.y, tile.width, tile.height);
			ctx.fill();
			if (tile.color == -1) {
				// no color -> a color
				tilesColored++;
				colorInventory[newColor]--;
			} else if (newColor == -1) {
				// a color -> no color
				tilesColored--;
				colorInventory[tile.color]++;
			} else {
				// this color -> new color
				colorInventory[tile.color]++;
				colorInventory[newColor]--;
			}
			updateRemainingColors();
			tile.color = newColor;
		}

		function getNextColor(tileColor) {
			if (tileColor == -1) {
				return 0;
			} else if (tileColor == 0) {
				return 1;
			} else if (tileColor == 1) {
				return 2;
			} else if (tileColor == 2) {
				return 3;
			} else {
				return -1;
			}
		}

		function validateGame() {
			switch (TILE_SHAPE) {
				case "square":
					return validateSquareGame();
				case "rhombus":
				case "hexagon":
				default:
					return false;
			}
		}

		function validateSquareGame() {
			for (var i = 0; i < MAX_TILES; i++) {
				var row = ~~(i/MAX_ROWS);
				var col = i%MAX_COLS;
				if (row - 1 >= 0) {
					if (tiles[row][col].color === tiles[row - 1][col].color) {
//						alert("tiles[" + row + "][" + col + "] (" + tiles[row][col].color + ") == tiles[" + (row-1) + "][" + col + "] (" + tiles[row-1][col].color + ")");
						return false;
					}
				}
				if (col - 1 >= 0) {
					if (tiles[row][col].color === tiles[row][col - 1].color) {
//						alert("tiles[" + row + "][" + col + "] (" + tiles[row][col].color + ") == tiles[" + row + "][" + (col-1) + "] (" + tiles[row][col-1].color + ")");
						return false;
					}
				}
				if (row + 1 < MAX_ROWS) {
					if (tiles[row][col].color === tiles[row + 1][col].color) {
//						alert("tiles[" + row + "][" + col + "] (" + tiles[row][col].color + ") == tiles[" + (row+1) + "][" + col + "] (" + tiles[row+1][col].color + ")");
						return false;
					}
				}
				if (col + 1 < MAX_COLS) {
					if (tiles[row][col].color === tiles[row][col + 1].color) {
//						alert("tiles[" + row + "][" + col + "] (" + tiles[row][col].color + ") == tiles[" + row + "][" + (col+1) + "] (" + tiles[row][col+1].color + ")");
						return false;
					}
				}
			}
			return true;
		}

		function createFixedTiles() {
			tiles[0][0].fixed = true;
			tiles[0][0].color = 0;
			colorInventory[0]--;
			tiles[1][1].fixed = true;
			tiles[1][1].color = 1;
			colorInventory[1]--;
			tiles[2][2].fixed = true;
			tiles[2][2].color = 2;
			colorInventory[2]--;
			tiles[3][3].fixed = true;
			tiles[3][3].color = 3;
			colorInventory[3]--;
			fillFixedTile();
			drawRemainingColors();
		}

		function fillFixedTile() {
			for (var i = 0; i < MAX_ROWS; i++) {
				for (var j = 0; j < MAX_COLS; j++) {
					if (tiles[i][j].fixed === true) {
						ctx.fillStyle = palette[tiles[i][j].color];
						ctx.strokeStyle = "#000000";
						ctx.clearRect(tiles[i][j].x, tiles[i][j].y, tiles[i][j].width, tiles[i][j].height);

						// fill color
						ctx.beginPath();
						ctx.rect(tiles[i][j].x, tiles[i][j].y, tiles[i][j].width, tiles[i][j].height);
						ctx.fill();
						//ctx.stroke();
						ctx.closePath();

						// draw X on fixed tile
						ctx.beginPath();
						ctx.moveTo(tiles[i][j].x, tiles[i][j].y);
						ctx.lineTo(tiles[i][j].x+tiles[i][j].width, tiles[i][j].y+tiles[i][j].height);
						ctx.stroke();
						ctx.closePath();
						ctx.beginPath();
						ctx.moveTo(tiles[i][j].x+tiles[i][j].width, tiles[i][j].y);
						ctx.lineTo(tiles[i][j].x, tiles[i][j].y+tiles[i][j].height);
						ctx.stroke();
						ctx.closePath();

						tilesColored++;
					}
				}
			}
		}

		function initializeColorInventory() {
			/*var total;
			do {
				for (var i = 0; i < 4; i++) {
					colorInventory[i] = Math.floor((Math.random() * 10) + 1);
					total += colorInventory[i];
				}
			}
			while (total !== MAX_TILES);*/

			/*var remainder;
			do {
				remainder = 16;
				for (var i = 0; i < 4; i++) {
					colorInventory[i] = Math.floor((Math.random() * MAX_TILES / 2 ) + 1);
					remainder -= colorInventory[i];
				}
			}
			while (remainder != 0);*/
			colorInventory[0] = 2;
			colorInventory[1] = 4;
			colorInventory[2] = 5;
			colorInventory[3] = 5;
			//alert(colorInventory[0] + " " + colorInventory[1] + " " + colorInventory[2] + " " + colorInventory[3]);
			drawColorInventory();
		}

		function drawColorInventory() {
			//alert(c.height);
			var colorInvX = OFFSET_LEFT;
			// OFFSET_TOP + BOARD_HEIGHT + OFFSET_LEFT
			var colorInvY = 400;
			var colorInvWidth = BOARD_WIDTH;
			// c.height - OFFSET_TOP - BOARD_HEIGHT - OFFSET_LEFT - OFFSET_LEFT
			var colorInvHeight = 60;

			ctx.fillStyle = "#FFFFFF";
			ctx.strokeStyle = "#000000";
			ctx.beginPath();
			ctx.rect(colorInvX, colorInvY, colorInvWidth, colorInvHeight);
			ctx.fill();
			ctx.stroke();
			ctx.closePath();

			ctx.fillStyle = palette[0];
			ctx.fillRect(30, 410, 30, 40);
			ctx.fillStyle = palette[1];
			ctx.fillRect(100, 410, 30, 40);
			ctx.fillStyle = palette[2];
			ctx.fillRect(170, 410, 30, 40);
			ctx.fillStyle = palette[3];
			ctx.fillRect(240, 410, 30, 40);

//			ctx.beginPath();
//			drawRemainingColors();
			/*ctx.fillText("10", 65, 435);
			ctx.fillText("10", 135, 435);
			ctx.fillText("10", 205, 435);
			ctx.fillText("10", 275, 435);*/
		}

		function drawRemainingColors() {
			ctx.font = "15px Arial";
			ctx.fillStyle = "#000000";
			ctx.fillText(colorInventory[0], 65, 435);
			ctx.fillText(colorInventory[1], 135, 435);
			ctx.fillText(colorInventory[2], 205, 435);
			ctx.fillText(colorInventory[3], 275, 435);
		}

		function updateRemainingColors() {
			ctx.clearRect(65, 410, 20, 40);
			ctx.clearRect(135, 410, 20, 40);
			ctx.clearRect(205, 410, 20, 40);
			ctx.clearRect(275, 410, 20, 40);
			drawRemainingColors();
		}

		function createTimer() {
			ctx.strokeStyle = "#000000";
			ctx.beginPath();
			ctx.strokeRect(20, 20, 200, 60);
			ctx.closePath();
		}

		function createPauseBtn() {
			ctx.strokeStyle = "#000000";
			ctx.beginPath();
			ctx.strokeRect(240, 20, 60, 60);
			ctx.closePath();
		}
	};

</script>
</head>
<body>

	<canvas id="myCanvas" width="320" height="480" style="border:1px solid #d3d3d3;">
	Your browser does not support the HTML5 canvas tag.</canvas>

</body>
</html>